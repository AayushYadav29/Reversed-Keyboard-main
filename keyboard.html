<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keyboard Map | Reversed Keyboard</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="keyboard-page">
  <!-- Snowfall -->
  <div class="snowfall" id="snowfall"></div>
  
  <!-- Blur Overlay -->
  <div class="blur-overlay"></div>
  
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <a href="index.html" class="logo">
        <span class="logo-icon">⌨</span>
        <span class="logo-text">reversed<span class="logo-highlight">keyboard</span></span>
      </a>
    </div>
    <nav class="header-nav">
      <a href="index.html" class="nav-item" title="Level 1">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span>home</span>
      </a>
      <a href="level2.html" class="nav-item" id="level2NavLink" title="Level 2">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        <span>level 2</span>
      </a>
    </nav>
    <div class="header-right">
    </div>
  </header>

  <main class="main-content">
    <h1 style="color: var(--main-color); margin-bottom: 0.5rem;">keyboard map</h1>
    <p style="color: var(--sub-color); margin-bottom: 2rem;">type the left key to get the right key</p>
    
    <div class="keyboard-grid" id="keyboardGrid"></div>
  </main>

  <footer class="footer">
    <div class="footer-left">
      <span class="footer-hint">level 1 - reversed alphabet</span>
    </div>
    <div class="footer-right">
      <span class="footer-version">a → z, b → y, c → x...</span>
    </div>
  </footer>

  <!-- Level 2 Locked Modal -->
  <div id="level2LockedModal" class="modal">
    <div class="modal-content modal-locked">
      <div class="locked-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
      </div>
      <h2>level 2 locked</h2>
      <p class="modal-subtitle">complete level 1 to unlock</p>
      <div class="locked-requirements">
        <div class="requirement-item">
          <span class="requirement-label">accuracy</span>
          <span class="requirement-value">&gt; 80%</span>
        </div>
        <div class="requirement-item">
          <span class="requirement-label">wpm</span>
          <span class="requirement-value">&gt; 30</span>
        </div>
      </div>
      <div class="locked-current" id="lockedCurrentScore" style="display: none;">
        <p class="current-score-label">your current score</p>
        <div class="current-score-values">
          <span id="lockedCurrentAcc">0%</span>
          <span class="score-separator">|</span>
          <span id="lockedCurrentWpm">0 wpm</span>
        </div>
      </div>
      <button id="closeLockedModal" class="action-btn primary full-width">got it</button>
    </div>
  </div>

  <!-- Keyboard generation logic -->
  <script>
    const keyboardMap = {
      'a': 'z', 'b': 'y', 'c': 'x', 'd': 'w', 'e': 'v',
      'f': 'u', 'g': 't', 'h': 's', 'i': 'r', 'j': 'q',
      'k': 'p', 'l': 'o', 'm': 'n', 'n': 'm', 'o': 'l',
      'p': 'k', 'q': 'j', 'r': 'i', 's': 'h', 't': 'g',
      'u': 'f', 'v': 'e', 'w': 'd', 'x': 'c', 'y': 'b',
      'z': 'a'
    };

    function initializeKeyboardMap() {
      const keyboardGrid = document.getElementById('keyboardGrid');
      Object.entries(keyboardMap).forEach(([key, value]) => {
        const keyPairDiv = document.createElement('div');
        keyPairDiv.className = 'key-pair';
        keyPairDiv.innerHTML = `
          <span class="key-original">${key.toUpperCase()}</span>
          <span class="key-arrow">→</span>
          <span class="key-mapped">${value.toUpperCase()}</span>
        `;
        keyboardGrid.appendChild(keyPairDiv);
      });
    }

    initializeKeyboardMap();
    
    // Show Level 2 Locked Modal
    function showLevel2LockedModal(level1Result) {
      const modal = document.getElementById('level2LockedModal');
      if (!modal) return;
      
      const currentScoreSection = document.getElementById('lockedCurrentScore');
      const currentAcc = document.getElementById('lockedCurrentAcc');
      const currentWpm = document.getElementById('lockedCurrentWpm');
      
      if (level1Result && currentScoreSection) {
        currentScoreSection.style.display = 'block';
        if (currentAcc) currentAcc.textContent = Math.round(level1Result.accuracy) + '%';
        if (currentWpm) currentWpm.textContent = Math.round(level1Result.wpm) + ' wpm';
      } else if (currentScoreSection) {
        currentScoreSection.style.display = 'none';
      }
      
      modal.style.display = 'block';
      
      // Close button handler
      const closeBtn = document.getElementById('closeLockedModal');
      if (closeBtn) {
        closeBtn.onclick = () => {
          modal.style.display = 'none';
        };
      }
      
      // Click outside to close
      modal.onclick = (e) => {
        if (e.target === modal) {
          modal.style.display = 'none';
        }
      };
    }
    
    // Block Level 2 nav link until Level 1 is completed
    const level2NavLink = document.getElementById('level2NavLink');
    if (level2NavLink) {
      level2NavLink.addEventListener('click', (e) => {
        let level1 = null;
        try {
          const raw = localStorage.getItem('rk_result_level_1');
          level1 = raw ? JSON.parse(raw) : null;
        } catch (_) {}
        
        const meetsRequirements = level1 && level1.accuracy > 80 && level1.wpm > 30;
        
        if (!meetsRequirements) {
          e.preventDefault();
          showLevel2LockedModal(level1);
        }
      });
    }
  </script>
</body>
</html>
